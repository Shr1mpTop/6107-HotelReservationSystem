# 酒店预订管理系统 - 使用指南

## 目录
1. [快速开始](#快速开始)
2. [系统功能详解](#系统功能详解)
3. [用户角色与权限](#用户角色与权限)
4. [常见操作流程](#常见操作流程)
5. [故障排除](#故障排除)

## 快速开始

### 1. 环境准备

**系统要求：**
- Python 3.8 或更高版本
- SQLite 3
- 支持的操作系统：Windows, macOS, Linux

### 2. 安装步骤

```bash
# 克隆或下载项目
cd 6107-HotelReservationSystem

# 安装依赖
pip install -r requirements.txt

# 初始化数据库
python src/database/init_db.py

# 启动系统
python src/main.py
```

**或使用快速启动脚本：**

Linux/Mac:
```bash
./run.sh
```

Windows:
```cmd
run.bat
```

### 3. 首次登录

系统初始化后会创建三个默认账户：

| 角色 | 用户名 | 密码 | 权限 |
|------|--------|------|------|
| 管理员 | admin | admin123 | 完全访问 |
| 前台员工 | frontdesk | front123 | 预订和运营管理 |
| 客房员工 | housekeeping | house123 | 房间状态管理 |

**⚠️ 安全建议：首次登录后请立即修改密码！**

## 系统功能详解

### 1. 预订管理

#### 1.1 查询可用房间
- **功能**：根据入住/退房日期和房型查询可用房间
- **输入**：
  - 入住日期（YYYY-MM-DD格式）
  - 退房日期（YYYY-MM-DD格式）
  - 房型ID（可选）
- **输出**：可用房间列表，包含房型、价格、楼层等信息

**示例：**
```
入住日期: 2026-02-01
退房日期: 2026-02-05
房型ID: 1 (或留空查询所有)

结果: 显示该日期范围内所有可用的标准单人间
```

#### 1.2 创建新预订
- **功能**：为客人创建预订
- **步骤**：
  1. 输入入住/退房日期
  2. 查看并选择可用房间
  3. 填写客人信息（姓、名、手机号、邮箱等）
  4. 输入客人数量和特殊要求
  5. 确认预订信息
  6. 系统自动计算价格并创建预订
  7. 发送确认邮件（模拟）

**注意事项：**
- 手机号是必填项，用于客人识别
- 客人数量不能超过房间最大容纳量
- 系统会自动检查超售冲突

#### 1.3 查询预订
- **功能**：通过多种条件查询预订
- **查询条件**（可组合）：
  - 预订ID
  - 客人姓名（模糊匹配）
  - 手机号
  - 房间号
  - 预订状态
  - 入住日期

#### 1.4 修改预订
- **功能**：修改确认状态的预订
- **可修改内容**：
  - 入住/退房日期
  - 房间
  - 客人数量
  - 特殊要求
- **限制**：
  - 只能修改"已确认(Confirmed)"状态的预订
  - 不能修改已到入住日期的预订
  - 修改会重新计算价格
  - 系统会检查新日期/房间的冲突

#### 1.5 取消预订
- **功能**：取消预订
- **限制**：
  - 不能取消已退房的预订
  - 已入住的预订需先办理退房
- **效果**：
  - 预订状态改为"已取消(Cancelled)"
  - 发送取消通知邮件

### 2. 运营管理

#### 2.1 办理入住
- **功能**：将预订状态改为已入住
- **步骤**：
  1. 输入预订ID
  2. 查看预订详情
  3. 确认办理入住
- **系统操作**：
  - 预订状态: Confirmed → CheckedIn
  - 房间状态: Clean → Occupied
- **注意**：允许提前一天办理入住

#### 2.2 办理退房
- **功能**：处理客人退房和结算
- **步骤**：
  1. 输入预订ID
  2. 选择支付方式（现金/信用卡/借记卡/在线转账）
  3. 输入支付金额
  4. 确认收款
- **系统操作**：
  - 预订状态: CheckedIn → CheckedOut
  - 房间状态: Occupied → Dirty
  - 记录支付信息
- **支付方式**：
  - Cash - 现金
  - CreditCard - 信用卡
  - DebitCard - 借记卡
  - OnlineTransfer - 在线转账

#### 2.3 查看今日入住
显示当日预计入住的所有预订列表

#### 2.4 查看当前在住
显示当前所有已入住客人的列表

### 3. 房间管理

#### 3.1 查看房间状态
- **功能**：查看所有房间的状态
- **显示信息**：
  - 房间号、房型、楼层
  - 当前状态（Clean/Dirty/Occupied/Maintenance）
  - 最大入住人数、基础价格

**房间状态说明：**
- **Clean（清洁）**：可预订状态
- **Dirty（脏污）**：待清洁，不可预订
- **Occupied（已占用）**：有客人入住
- **Maintenance（维护中）**：维修中，不可预订

#### 3.2 更新房间状态
- **功能**：更改房间状态
- **常用场景**：
  - 客房清洁完成：Dirty → Clean
  - 房间需要维修：Clean → Maintenance
  - 维修完成：Maintenance → Clean

**权限：**
- 客房员工：主要负责清洁状态更新
- 前台/管理员：可更新所有状态

#### 3.3 添加房间（管理员）
- **功能**：向系统添加新房间
- **必填信息**：
  - 房间号（唯一）
  - 房型ID
  - 楼层

#### 3.4 房型管理（管理员）
- **查看房型**：显示所有房型及其配置
- **添加房型**：创建新的房型
- **修改房型**：更新房型信息（名称、价格、设施等）

**房型配置：**
- 房型名称
- 描述
- 基础价格
- 最大入住人数
- 设施（如WiFi、电视、空调等）

### 4. 定价配置（管理员）

#### 4.1 季节性定价
- **功能**：为特定日期范围设置特殊价格
- **定价方式**：
  1. **价格乘数**：基于基础价格的倍数
     - 例如：1.5 表示150%，即价格上涨50%
  2. **固定价格**：指定固定金额
     - 例如：春节期间固定价格500元

**创建季节性定价：**
1. 选择房型
2. 输入季节名称（如"春节旺季"）
3. 设置日期范围
4. 选择定价方式并输入价格

**注意：**
- 系统会检查日期冲突，同一房型的季节性定价不能重叠
- 季节性定价优先于基础价格

#### 4.2 查看定价规则
显示所有活动的季节性定价规则

#### 4.3 删除定价规则
删除不再需要的季节性定价规则（软删除）

### 5. 报表管理（管理员）

#### 5.1 入住率报表
- **功能**：分析指定时期的房间入住情况
- **输入**：开始日期、结束日期
- **输出**：
  - 平均入住率
  - 每日入住情况（总房间数、已占用、可用、入住率）
- **导出**：可导出为CSV文件

**示例报表：**
```
报表期间: 2026-01-01 至 2026-01-31
总房间数: 25
平均入住率: 65.4%

每日数据：
日期       | 总房间 | 已占用 | 可用 | 入住率
2026-01-01 |   25   |   15   |  10  | 60.0%
2026-01-02 |   25   |   18   |   7  | 72.0%
...
```

#### 5.2 收入报表
- **功能**：统计指定时期的收入情况
- **输入**：开始日期、结束日期
- **输出**：
  - 总预订数
  - 总收入
  - 平均每预订收入
  - 按房型统计收入
  - 按支付方式统计
- **导出**：可导出为CSV文件

#### 5.3 审计日志查询
- **功能**：查询系统操作记录
- **查询条件**：
  - 操作类型（CREATE/UPDATE/DELETE等）
  - 表名
  - 日期范围
- **显示信息**：
  - 操作时间
  - 操作用户
  - 操作类型
  - 受影响的表和记录
  - 操作描述

**常见操作类型：**
- LOGIN - 用户登录
- LOGOUT - 用户登出
- CREATE - 创建记录
- UPDATE - 更新记录
- DELETE - 删除记录
- MODIFY - 修改预订
- CANCEL - 取消预订
- CHECK_IN - 办理入住
- CHECK_OUT - 办理退房
- STATUS_UPDATE - 状态更新
- BACKUP - 数据库备份

#### 5.4 数据库备份
- **功能**：手动创建数据库备份
- **步骤**：
  1. 输入备份文件名
  2. 确认执行备份
- **备份位置**：`backups/` 目录
- **文件命名**：`{备份名}_{时间戳}.db`
- **记录**：备份操作会记录到系统中，包含文件大小、创建者等信息

### 6. 系统管理

#### 6.1 修改密码
- **功能**：修改当前用户密码
- **步骤**：
  1. 输入当前密码
  2. 输入新密码
  3. 确认新密码
- **安全要求**：
  - 必须验证当前密码
  - 新密码两次输入必须一致

#### 6.2 查看备份历史
显示所有数据库备份记录，包括：
- 备份文件名
- 文件大小
- 备份类型（手动/自动）
- 备份状态
- 创建者
- 创建时间

#### 6.3 系统统计
显示系统整体运行情况：
- 房间状态统计
- 今日入住统计
- 当前在住客人数
- 活动会话数

## 用户角色与权限

### 管理员（admin）
**完全访问权限**，可以使用所有功能：
- ✅ 预订管理
- ✅ 运营管理
- ✅ 房间管理（包括添加房间、管理房型）
- ✅ 定价配置
- ✅ 报表管理
- ✅ 系统管理

### 前台员工（front_desk）
**负责预订和入住/退房操作：**
- ✅ 预订管理（查询、创建、修改、取消）
- ✅ 运营管理（办理入住/退房）
- ✅ 查看房间状态
- ❌ 房间管理（添加/修改房间）
- ❌ 定价配置
- ❌ 报表管理
- ❌ 系统管理

### 客房员工（housekeeping）
**负责房间清洁状态管理：**
- ✅ 查看房间状态
- ✅ 更新房间状态（主要是清洁状态）
- ❌ 预订管理
- ❌ 运营管理
- ❌ 其他管理功能

## 常见操作流程

### 流程1：标准预订流程

```
1. 前台员工登录系统
   ↓
2. 选择"预订管理" → "查询可用房间"
   ↓
3. 输入客人需求的日期和房型
   ↓
4. 查看可用房间列表和价格
   ↓
5. 选择"创建新预订"
   ↓
6. 选择合适的房间
   ↓
7. 填写客人信息
   ↓
8. 确认预订
   ↓
9. 系统创建预订并发送确认邮件
   ↓
10. 告知客人预订号
```

### 流程2：入住流程

```
1. 客人到达酒店
   ↓
2. 前台查询预订（通过预订号/姓名/手机号）
   ↓
3. 核对客人信息
   ↓
4. 选择"运营管理" → "办理入住"
   ↓
5. 输入预订ID
   ↓
6. 确认入住信息
   ↓
7. 系统更新预订和房间状态
   ↓
8. 发放房卡，告知房间号
```

### 流程3：退房流程

```
1. 客人到前台办理退房
   ↓
2. 前台选择"运营管理" → "办理退房"
   ↓
3. 输入预订ID或查询客人信息
   ↓
4. 核对账单金额
   ↓
5. 选择支付方式
   ↓
6. 输入支付金额
   ↓
7. 确认收款
   ↓
8. 系统记录支付，更新状态
   ↓
9. 房间状态自动改为"脏污"
   ↓
10. 通知客房部清洁房间
```

### 流程4：房间清洁流程

```
1. 客房员工登录系统
   ↓
2. 查看"房间状态"
   ↓
3. 找到状态为"Dirty"的房间
   ↓
4. 完成房间清洁
   ↓
5. 选择"更新房间状态"
   ↓
6. 输入房间号
   ↓
7. 将状态改为"Clean"
   ↓
8. 房间重新变为可预订状态
```

### 流程5：季节性定价配置

```
1. 管理员登录系统
   ↓
2. 选择"定价配置" → "添加季节性定价"
   ↓
3. 选择要设置的房型
   ↓
4. 输入季节名称（如"国庆黄金周"）
   ↓
5. 设置日期范围（2026-10-01 至 2026-10-07）
   ↓
6. 选择定价方式：
   - 价格乘数: 2.0 (价格翻倍)
   或
   - 固定价格: 800元
   ↓
7. 确认创建
   ↓
8. 系统在指定日期范围内应用新价格
```

## 故障排除

### 问题1：无法登录

**症状**：输入用户名密码后提示错误

**解决方案**：
1. 检查用户名和密码是否正确（区分大小写）
2. 使用默认账户尝试登录：
   - admin / admin123
   - frontdesk / front123
   - housekeeping / house123
3. 如果忘记密码，需要管理员重置或重新初始化数据库

### 问题2：预订创建失败

**可能原因及解决方案**：

1. **"房间已被预订"**
   - 原因：所选房间在日期范围内已有预订
   - 解决：重新查询可用房间或选择其他日期

2. **"客人数量超过最大容纳量"**
   - 原因：输入的客人数量超过房间限制
   - 解决：减少客人数量或选择更大的房型

3. **"入住日期不能早于今天"**
   - 原因：试图预订过去的日期
   - 解决：检查日期输入是否正确

4. **"日期格式无效"**
   - 原因：日期格式不正确
   - 解决：使用 YYYY-MM-DD 格式（如 2026-02-01）

### 问题3：无法办理入住

**可能原因及解决方案**：

1. **"预订状态为XXX，无法办理入住"**
   - 原因：预订状态不是"Confirmed"
   - 解决：检查预订是否已取消或已入住

2. **"入住日期为XXX，现在还不能办理入住"**
   - 原因：距离入住日期太早（超过1天）
   - 解决：等待临近入住日期或联系管理员

### 问题4：数据库错误

**症状**：操作时出现数据库相关错误

**解决方案**：
1. 检查 `data/hrms.db` 文件是否存在
2. 检查文件权限是否正确
3. 尝试重新初始化数据库：
   ```bash
   python src/database/init_db.py
   ```
   ⚠️ 注意：这会清空所有数据！

### 问题5：会话超时

**症状**：操作一段时间后提示"会话已过期"

**原因**：30分钟无操作自动登出（安全机制）

**解决方案**：重新登录即可

### 问题6：CSV导出失败

**可能原因及解决方案**：

1. **"没有写入权限"**
   - 原因：当前目录没有写入权限
   - 解决：检查文件夹权限或以管理员身份运行

2. **"文件被占用"**
   - 原因：CSV文件在其他程序中打开
   - 解决：关闭Excel或其他程序后重试

### 问题7：季节性定价冲突

**症状**：添加季节性定价时提示日期冲突

**原因**：同一房型已有重叠日期的定价规则

**解决方案**：
1. 查看现有定价规则：选择"定价配置" → "查看季节性定价"
2. 删除冲突的规则或调整新规则的日期范围

## 技术支持

如遇到其他问题，请：
1. 查看终端/控制台的错误信息
2. 检查 `logs/` 目录下的日志文件
3. 参考 README.md 中的项目结构说明
4. 检查数据库连接和文件权限

## 附录：键盘快捷键

- **Ctrl+C**：中断当前操作（返回上级菜单）
- **回车**：使用默认值（如果有）
- **0**：返回上级菜单或退出

## 附录：数据格式说明

### 日期格式
- 标准格式：YYYY-MM-DD
- 示例：2026-02-01

### 时间格式
- 标准格式：YYYY-MM-DD HH:MM:SS
- 示例：2026-02-01 14:30:00

### 电话号码
- 格式：11位数字
- 示例：13800138000

### 邮箱地址
- 格式：标准邮箱格式
- 示例：guest@example.com

### 身份证号
- 格式：15位或18位
- 示例：110101199001011234

---

**版本**：1.0  
**最后更新**：2026-01-15

感谢使用酒店预订管理系统！
